#!/bin/bash

# --- Цвета и функции логирования ---
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
VERY_LIGHT_BLUE='\033[0;36m'
NC='\033[0m' # No Color

log() {
    echo -e "${VERY_LIGHT_BLUE}[$(date '+%Y-%m-%d %H:%M:%S')]${NC} $1"
}

error() {
    echo -e "${RED}[ОШИБКА]${NC} $1" >&2
}

success() {
    echo -e "${GREEN}[УСПЕХ]${NC} $1"
}

warning() {
    echo -e "${YELLOW}[ПРЕДУПРЕЖДЕНИЕ]${NC} $1"
}
# --- Конец секции логирования ---

# --- Основные функции ---

# Функция для установки nvm и nodejs
install_nodejs() {
    log "Проверка наличия nvm..."
    if [ -s "$HOME/.nvm/nvm.sh" ]; then
        log "nvm уже установлен."
        source "$HOME/.nvm/nvm.sh"
    else
        log "nvm не найден. Установка nvm..."
        curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
        export NVM_DIR="$HOME/.nvm"
        [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
        [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"
        success "nvm успешно установлен."
    fi

    log "Проверка наличия nodejs..."
    if command -v node &> /dev/null; then
        log "nodejs уже установлен. Версия: $(node -v)"
    else
        log "nodejs не найден. Установка последней LTS версии nodejs..."
        nvm install --lts
        success "nodejs успешно установлен. Версия: $(node -v)"
    fi
}

# Функция для установки gemini-cli
install_gemini_cli() {
    log "Проверка наличия gemini-cli..."
    if command -v gemini &> /dev/null; then
        log "gemini-cli уже установлен."
    else
        log "gemini-cli не найден. Установка gemini-cli..."
        npm install -g @google/gemini-cli
        success "gemini-cli успешно установлен."
    fi
}

# --- Основная логика ---
main() {
    log "Запуск скрипта установки AI инструментов."

    install_nodejs
    install_gemini_cli

    success "Скрипт успешно завершил работу."
}

# Запуск
main "$@"